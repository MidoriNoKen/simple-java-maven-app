pipeline {
    agent any
    stages {
        stage('Build') {
            steps {
                sh 'mvn clean package'
            }
        }
        stage('Test') {
            steps {
                sh 'mvn test'
            }
        }
        stage('Deploy to Heroku') {
            steps {
                script {
                    def herokuApiKey = credentials('eaeeb0eb-d969-420f-83ae-553e2aba3d53')
                    sh 'heroku container:login'
                    sh 'heroku container:push web --app submission-cicd-pipeline-midor'
                    sh 'heroku container:release web --app submission-cicd-pipeline-midor'
                }
            }
        }
    }
}
